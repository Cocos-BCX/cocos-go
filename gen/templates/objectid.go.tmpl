package types

import (
	"github.com/cheekybits/genny/generic"
	"github.com/denkhaus/bitshares/util"
	"github.com/juju/errors"
)

type T1 generic.Type

type T1ID struct {
	ObjectID
}

func (p T1ID) Marshal(enc *util.TypeEncoder) error {
	if err := enc.EncodeUVarint(uint64(p.Instance())); err != nil {
		return errors.Annotate(err, "encode instance")
	}

	return nil
}

func (p *T1ID) Unmarshal(dec *util.TypeDecoder) error {
	var instance uint64
	if err := dec.DecodeUVarint(&instance); err != nil {
		return errors.Annotate(err, "decode instance")
	}

	p.number = UInt64((uint64(SpaceTypeProtocol) << 56) | (uint64(ObjectTypeT1) << 48) | instance)
	return nil
}

type T1IDs []T1ID

func (p T1IDs) Marshal(enc *util.TypeEncoder) error {
	if err := enc.EncodeUVarint(uint64(len(p))); err != nil {
		return errors.Annotate(err, "encode length")
	}

	for _, ex := range p {
		if err := enc.Encode(ex); err != nil {
			return errors.Annotate(err, "encode T1ID")
		}
	}

	return nil
}

//NewT1ID creates an new T1ID object
func NewT1ID(id string) *T1ID {
	gid := new(T1ID)
	if err := gid.Parse(id); err != nil {
		panic(errors.Annotate(err, "Parse"))
	}

	return gid
}
